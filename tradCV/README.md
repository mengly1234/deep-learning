# 图像配准

## 1、图像配准定义：

​		图像配准是将不同时间、不同传感器在不同视角下获取的同一物体进行匹配、对齐的过程，通俗来说，就是找到图像A中的某一个特征点在图像B中对应的位置，使它们在空间上对应起来。

## 2、图像之间的空间关系：

​		平移、旋转、缩放、仿射变换、投影变换

## 3、常用的图像特征

**（1）颜色特征**：全局特征，不受旋转和平移的影响，但不能表达出颜色空间分布信息。

​	**a、**颜色直方图：

​		颜色直方图能够简单的描述一幅图像中颜色的全局分布，及不同色彩再整幅图像中所占的比例，但是无法描述图像局部分布以及每种色彩所处的空间位置。

颜色直方图特征匹配方法：直方图相交法、距离法、中心距法、参考颜色表法、累加颜色直方图法

​	**b、**颜色集

​		颜色集是对颜色直方图的一种近似首先将图像从 RGB颜色空间转化成视觉均衡的颜色空间（如 HSV 空间），并将颜色空间量化成若干个柄。然后，用色彩自动分割技术将图像分为若干区域，每个区域用量化颜色空间的某个颜色分量来索引，从而将图像表达为一个二进制的颜色索引集。在图像匹配中，比较不同图像颜色集之间的距离和色彩区域的空间关系。

​	**c、**颜色矩

​		由于颜色分布信息主要集中在低阶矩中，因此，仅采用颜色的一阶矩（mean）、二阶矩（variance）和三阶矩（skewness）就足以表达图像的颜色分布。

​	**d、**颜色聚合向量

​		将属于直方图每一个柄的像素分成两部分，如果该柄内的某些像素所占据的连续区域的面积大于给定的阈值，则该区域内的像素作为聚合像素，否则作为非聚合像素。

​	**e、**颜色相关图

**（2）纹理特征：**与颜色特征不同，纹理特征不是基于像素点的特征，他描述了图像局部区域的表面性质，它需要在包含多个像素点的区域中进行统计计算。检索的图像粗细、疏密等方面差别较大的时候，利用纹理特征是一种有效的方法，但是如果差别不大，就很难反应不同区域纹理的差别。

​	**a、**统计方法

​		灰度共生矩阵的纹理特征分析方法

​		从图像的自相关函数（即图像的能量谱函数）提取纹理特征，即通过对图像的能量谱函数的计算，提取纹理的粗细度及方向性等特征参数

​	**b、**几何法

​		Voronio 棋盘格特征法和结构法

​	**c、**模型法

​		随机场模型法，如马尔可夫（Markov）随机场（MRF）模型法和 Gibbs 随机场模型法

​	**d、**信号处理法

​	总结：

​	纹理特征的提取与匹配主要有：灰度共生矩阵、Tamura 纹理特征、自回归纹理模型、小波变换等

**（3）形状特征**：形状特征有两类表示方法：**轮廓特征**、**区域特征**。轮廓特征主要针对物体的外边界，而图像的区域特征则关系到整个形状区域。几种典型的形状特征描述方法：

​	**a、**边界特征法

​		Hough变换检测平行直线方法：利用图像全局特性而将边缘像素连接起来组成区域封闭边界的一种方法，其基本思想是点-线的对偶性。（Hough变换即将笛卡尔积坐标系中的直线使用极坐标表示，因为在笛卡尔积坐标系中垂直直线的斜率为无效大）

​		边界方向直方图方法：首先微分图像求得图像边缘，然后，做出关于边缘大小和方向的直方图，通常的方法是构造图像灰度梯度方向矩阵。边界方向直方图具有尺度不变性，能够较好的描述图像的大体形状，在一定程度上不受图像中物体位置旋转等因素的影响。

​	**b、**傅里叶形状描述符法

​		用物体边界的傅里叶变换作为形状描述，利用区域边界的封闭性和周期性，将二维问题转化为一维问题，由边界点导出三种形状表达，分别是曲率函数、质心距离、复坐标函数。

​	**c、**几何参数法

​		形状的表达和匹配采用更为简单的区域特征描述方法，例如采用有关形状定量测度（如矩、面积、周长等）的形状参数法，基于分割，分割效果很差的图像，形状参数甚至无法提取

​	**d、**形状不变矩

​		利用目标所占区域的矩作为形状描述参数，比如hu矩、Zernike 矩

**（4）空间关系特征**

​		指图像中分割出来的多个目标之间的相互的空间位置或相对方向关系，这些关系也可分为连接/邻接关系、交叠/重叠关系和包含/包 容关系等。通常空间位置信息可以分为两类：相对空间位置信息和绝对空间位置信息。

## 4、基于特征的图像配准方法

基本步骤：

- 特征检测（如灰度、色度、边缘、轮廓、角点等）

  常用的检测算法有：SIFT、SURF、ORB、AKAZE，矩方法等，其中前两者不能免费用于商用。

- 特征匹配：建立参考图像和感知图像中的特征之间的相关性，最常用的方法：BFMatcher.knnMatch()

- 图像变换：Homographies方法

## 5、基于深度学习的方法

 Multi-Temporal Remote Sensing Image Registration Using Deep Convolutional Features

论文链接：https://ieeexplore.ieee.org/stamp/stamp.jsp?tp=&arnumber=8404075

主要的思想就是使用VGG提取特征再进行匹配。



# 模板匹配

## 1、模板匹配定义

​		图像配准是指找到两张图像中的特征点，对特征点进行匹配。而模板匹配是在一张大的图像中寻找是否存在一个或多个较小的、预定义的模板图像。一般的匹配过程是遍历大图像的像素点（x，y），并计算以（x，y）为顶点，宽高与模板图像相同的局部图像与模板图像的相似度，找出与模板图像最像的区域。

## 2、比较的方法

*R*(*x*,*y*) 是匹配结果矩阵中的元素，*T*(*x*′,*y*′) 是模板图像的像素值，*I*(*x*+*x*′,*y*+*y*′) 是输入图像中对应位置的像素值

（1）平方差匹配法
$$
R(x,y) = \sum_{x',y'} (T(x',y') - I(x + x', y + y'))^2
$$
（2）归一化平方差匹配法
$$
R(x,y) = \frac{\sum_{x',y'} (T(x',y') - I(x + x', y + y'))^2}{\sqrt{\sum_{x',y'} T(x',y')^2 \cdot \sum_{x',y'} I(x + x', y + y')^2}}
$$
（3）相关性匹配法
$$
R(x,y) = \sum_{x',y'} (T(x',y') \cdot I(x + x', y + y'))
$$
（4）归一化相关性匹配法
$$
R(x,y) = \frac{\sum_{x',y'} (T(x',y') \cdot I(x + x', y + y'))}{\sqrt{\sum_{x',y'} T(x',y')^2 \cdot \sum_{x',y'} I(x + x', y + y')^2}}
$$
（5）相关系数匹配法
$$
R(x,y) = \sum_{x',y'} (T'(x',y') \cdot I'(x + x', y + y'))
$$
​	其中

（6）归一化相关系数匹配法
$$
R(x,y) = \frac{\sum_{x',y'} (T'(x',y') \cdot I'(x + x', y + y'))}{\sqrt{\sum_{x',y'} T'(x',y')^2 \cdot \sum_{x',y'} I'(x + x', y + y')^2}}
$$


